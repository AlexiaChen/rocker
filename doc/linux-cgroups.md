# Linux Cgroups

Cgroups (Control groups) provides the ability to limit, control and count the resources of a group of processes and future child processes, including CPU, memory, storage, network, etc. With Cgroups, you can easily limit the resource usage of a process and monitor the process statistics in real time.

There are three components in Cgroups.

1. cgroup

A cgroup contains a group of processes and can add various parameters of Linux subsystem to this cgroup to associate a group of processes with a group of subsystem's system parameters.

2. subsystem

is a group of resource control modules, generally containing the following.

- blkio, to do access control on block device (such as hard disk) input and output
- cpu, which sets the CPU scheduling policy for processes in a cgroup
- cpuacct, which can count the CPU usage of the processes in the cgroup
- cpuset, which sets the CPU and memory available to the processes in the cgroup in a multicore machine (the memory here is only applicable to NUMA architecture)
- devices, to control the access of the processes in the cgroup to the devices
- freezer, used to hang and resume the processes in the cgroup
- memory, used to control the memory neutralization of the processes in the cgroup
- net_cls, used to classify the network packets generated by the processes in the cgroup, so that the Linx traffic controller can distinguish the packets from a certain cgroup according to the classification and do flow restriction and monitoring
- net_prio, set the priority of the network traffic generated by the processes in the cgroup
- ns, which is special, is used to make the processes in the cgroup create a new cgroup when they fork a new process in the new namespace (NEWNS), and this cgroup contains the processes in the new namespace

Each subsystem is associated with the cgroup that defines the corresponding restrictions and makes the corresponding restrictions and controls on the processes in this cgroup, and these subsystems are iteratively merged into the Linux kernel. You can see which subsystems are currently supported by the kernel by installing ``sudo apt install cgroup-tools`'':

```bash
mathxh@MathxH:~/Project/rocker$ lssubsys -a
cpuset
cpu
cpuacct
blkio
memory
devices
freezer
net_cls
perf_event
net_prio
hugetlb
pids
rdma
```

3. hierarchy

It is a set of cgroups strung together into a tree structure, so that it is easy to inherit resource restrictions and management

## The interrelationship of the three components

Cgroups is achieved through the interworking of these three components.

- After the system creates a new hierarchy, all the processes in the system will join the cgroup root node of this hierarchy, which is created by default by the hierarchy

- A subsystem can only be attached to one hierarchy

- A hierarchy can be attached to multiple subsystems

- A process can be a member of more than one cgroup, but these cgroups must be in different hierarchy.

- When a process forks a child process, the child process is in the same cgroup as the parent process, and can be moved to other cgroups as needed

## Kernel interface for Cgroups

